{{ define "main" }}
  {{ if .Params.date_scope }}
    <div class="h-feed hfeed mb-20">
      {{ partial "archive/date-scope-heading.html" . }}
      {{ with .Content }}
        <div class="p-summary mb-8">{{ . }}</div>
      {{ end }}
      {{ partial "date-archive-content.html" . }}
    </div>
  {{ else }}
    <div class="h-feed hfeed mb-20">
      <h1 class="p-name mb-8 text-3xl text-light">{{ .Title }}</h1>
      {{ with .Content }}
        <div class="p-summary mb-8">{{ . }}</div>
      {{ end }}
      {{ $posts := partial "archive/all-posts.html" . }}
      {{ $paginator := .Paginate ($posts.ByDate) }}
      {{ $yearGroups := ($paginator.Pages.ByDate).GroupByDate "2006" }}
      {{ $allYearGroups := ($posts.ByDate).GroupByDate "2006" }}
      {{ $allYearKeys := slice }}
      {{ range $allYearGroups }}
        {{ $allYearKeys = $allYearKeys | append (printf "%s" .Key) }}
      {{ end }}
      {{ $allYearKeys = sort $allYearKeys }}
      {{ $yearGroupByKey := dict }}
      {{ $yearKeys := slice }}
      {{ range $yearGroups }}
        {{ $yearGroupByKey = merge $yearGroupByKey (dict .Key .) }}
        {{ $yearKeys = $yearKeys | append (printf "%s" .Key) }}
      {{ end }}
      {{ $yearKeys = sort $yearKeys }}
      {{ with $allYearKeys }}
        <nav class="mb-8 text-sm" aria-label="Years">
          <p class="inline">By year:</p>
          <ul class="list-none inline">
            {{ range $allYearKeys }}
              {{ $yearURL := (printf "/archive/%s/" .) | relURL }}
              <li class="mb-1 inline-block mr-2">
                <a href="{{ $yearURL }}">{{ . }}</a>
              </li>
            {{ end }}
          </ul>
        </nav>
      {{ end }}
      {{ range $yearKeys }}
        {{ $yearGroup := index $yearGroupByKey . }}
        {{ $yearLabel := ((index $yearGroup.Pages 0).Date.Format "2006") }}
        {{ $yearURL := (printf "/archive/%s/" $yearLabel) | relURL }}
        <section id="{{ $yearLabel }}" class="mb-8">
          <p
            class="mb-8 text-light text-orange text-xl"
            style="border-color: rgba(156, 163, 175, 1);"
          >
            <a href="{{ $yearURL }}" style="border: none; color: inherit;">{{ $yearLabel }}</a>
          </p>
          {{ $monthGroups := ($yearGroup.Pages.ByDate).GroupByDate "2006-01" }}
          {{ $monthGroupByKey := dict }}
          {{ $monthKeys := slice }}
          {{ range $monthGroups }}
            {{ $monthGroupByKey = merge $monthGroupByKey (dict .Key .) }}
            {{ $monthKeys = $monthKeys | append (printf "%s" .Key) }}
          {{ end }}
          {{ $monthKeys = sort $monthKeys }}
          {{ range $monthKeys }}
            {{ $monthGroup := index $monthGroupByKey . }}
            {{ $monthLabel := ((index $monthGroup.Pages 0).Date.Format "January") }}
            {{ $monthNum := ((index $monthGroup.Pages 0).Date.Format "01") }}
            {{ $monthURL := (printf "/archive/%s/%s/" $yearLabel $monthNum) | relURL }}
            <section class="mb-8">
              <p
                class="mb-16 text-light border-b-1 border-dashed"
                style="border-color: rgba(156, 163, 175, 1);"
              >
                <a href="{{ $monthURL }}" style="border: none; color: inherit;"
                  >{{ $monthLabel }}</a
                >
              </p>
              {{ partial "grouped-list-by-day.html" (dict "Pages" $monthGroup.Pages "ItemLayout" "li-grouped" "LinkDayToArchive" true "SortOrder" "asc") }}
            </section>
          {{ end }}
        </section>
      {{ end }}
      {{ partial "pagination.html" (dict "page" . "format" "terse") }}
    </div>
  {{ end }}
{{ end }}
