{{- $scope := .Params.date_scope -}}
{{- $isArchiveView := eq .Section "archive" -}}
{{- $posts := partial "archive/posts-for-scope.html" . -}}
{{- $posts = $posts.ByDate -}}

{{- if eq (len $posts) 0 -}}
  <p>No posts found for this date archive.</p>
{{- else if eq $scope "year" -}}
  {{- $monthGroups := $posts.GroupByDate "2006-01" -}}
  {{- $monthGroupByKey := dict -}}
  {{- $monthKeys := slice -}}
  {{- range $monthGroups -}}
    {{- $monthGroupByKey = merge $monthGroupByKey (dict .Key .) -}}
    {{- $monthKeys = $monthKeys | append (printf "%s" .Key) -}}
  {{- end -}}
  {{- $monthKeys = sort $monthKeys -}}
  {{- with $monthGroups -}}
    <nav class="mb-8 text-sm" aria-label="Months in {{ $.Title }}">
      <p class="inline">By month:</p>
      <ul class="list-none inline">
        {{- range $monthKeys -}}
          {{- $group := index $monthGroupByKey . -}}
          {{- $monthLabel := ((index $group.Pages 0).Date.Format "January") -}}
          {{- $monthNum := ((index $group.Pages 0).Date.Format "01") -}}
          {{- $monthURL := (printf "/archive/%v/%s/" $.Params.archive_year $monthNum) | relURL -}}
          <li class="mb-1 inline-block mr-2">
            <a href="{{ $monthURL }}">{{ $monthLabel }}</a>
          </li>
        {{- end -}}
      </ul>
    </nav>
  {{- end -}}
  {{- range $monthKeys -}}
    {{- $group := index $monthGroupByKey . -}}
    {{- $monthLabel := ((index $group.Pages 0).Date.Format "January") -}}
    {{- $monthNum := ((index $group.Pages 0).Date.Format "01") -}}
    {{- $monthID := (lower $monthLabel) -}}
    {{- $monthURL := (printf "/archive/%v/%s/" $.Params.archive_year $monthNum) | relURL -}}
    <section id="{{ $monthID }}" class="mb-8">
      <p
        class="mb-16 text-light border-b-1 border-dashed"
        style="border-color: rgba(156, 163, 175, 1);"
      >
        {{- if $isArchiveView -}}
          <a href="{{ $monthURL }}" style="border: none; color: inherit;">{{ $monthLabel }}</a>
        {{- else -}}
          {{ $monthLabel }}
        {{- end -}}
      </p>
      {{ partial "grouped-list-by-day.html" (dict "Pages" $group.Pages "ItemLayout" "li-grouped" "DayAnchorFormat" "month-day" "LinkDayToArchive" $isArchiveView "SortOrder" "asc") }}
    </section>
  {{- end -}}
{{- else if eq $scope "month" -}}
  {{ partial "grouped-list-by-day.html" (dict "Pages" $posts "ItemLayout" "li-grouped" "DayAnchorFormat" "month-day" "LinkDayToArchive" $isArchiveView "SortOrder" "asc") }}
{{- else -}}
  <ul class="mb-2">
    {{- range $posts.ByDate -}}
      {{ .Render "li-grouped" }}
    {{- end -}}
  </ul>
{{- end -}}
